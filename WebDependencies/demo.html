<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
		<title>
			Demo Application
		</title>
		<meta charset="utf-8">
		  <meta name="viewport" content="width=device-width, initial-scale=1">
		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.js"></script>
		<!-- <script src="demo.js" type="text/javascript"></script>
		<script src="crypto-js.js" type="text/javascript"></script> -->
		 <script src="data.js" type="text/javascript"></script> 
		
		<!-- SCRIPT PART1 -->
		<script>
	
	     //var billers;
         
		var mainApp = angular.module('mainApp',[])
		mainApp.controller('controller_biller', function($scope,$http){
		// 	$scope.flag1=false;
		// 	$scope.billers=[];
        //  var req = {
		// 	 method:'GET',
		// 	 url : 'http://localhost:8080/api/webapi/billeraccount/getAllBillerAccount',
		//  }
		//  $http(req).then(function(response){
			
		// 	$scope.billers = response.data
		// 	console.log($scope.billers);
		// 		//console.log(response.data)
		// 		$scope.flag1=true;
		// 		$scope.category();
		// 	}, function(error){

		// 		console.log('error')
		// 	})			
		// 	console.log($scope.billers);
		// 	 url : 'http://localhost:8080/api/webapi/billeraccount/getAllBillerAccount',
		// $scope.flag=false;
		// $scope.category_list=[];
		
		$http.get('http://localhost:8080/api/webapi/billeraccount/getAllBillerAccount').then(function(response){
			$scope.billers = response.data;
			//console.log($scope.billers);
			$scope.flag=true;

			//$scope.category1();
		})
	// 	while(flag==1){ 
	// 		console.log("lavee");
	 	console.log($scope.billers);

	// }


	

			


			// $scope.category1=function(){
				
			// 	$scope.billers.forEach(function(biller){
            //         $scope.category_list.push(biller);
            //     });
			// 	}

				//console.log($scope.category_list)
					
					$scope.category = '';
					$scope.final_biller_list = [];	
					//$scope.biller_list = [];				
					$scope.test1 = function (category) {
						$scope.category = category;
						console.log($scope.category);
						$scope.biller_list = [];
						$scope.country_list = [];
						$scope.billers.forEach(function(biller){
						if(biller.biller_category == category)	{

							if(!($scope.biller_list.includes(biller.biller_name)))
								$scope.biller_list.push(biller.biller_name);
									
							if(!($scope.country_list.includes(biller.biller_reg_state)) && !(biller.biller_reg_state == undefined)){
								   $scope.country_list.push(biller.biller_reg_state);
							}
							
						}	
						//console.log($scope.biller_list);											
					})	
					$scope.final_biller_list =$scope.biller_list;
					}
					

					// FILTER BY LOCATION
					$scope.location = 'None';
					$scope.find_loc_biller = function (location) {
						//console.log($scope.category );
						$scope.location = location;
						//console.log($scope.location);
						$scope.biller_list = [];

						$scope.billers.forEach(function(biller){
						if(biller.biller_category == $scope.category)	{
							if(biller.biller_reg_state == location){

								if(!($scope.biller_list.includes(biller.biller_name)))
									$scope.biller_list.push(biller.biller_name);
										
							}
						}												
					})	
					console.log($scope.biller_list);
					$scope.final_biller_list =$scope.biller_list;
					}
					

					// $scope.test1 = function (category) {
					// 	$scope.category = category;
					// 	$scope.biller_list = [];
					// 	billers.forEach(function(biller){
					// 	if(biller.biller_category == category)	{

					// 		if(!($scope.biller_list.includes(biller.biller_name)))
                   	// 			 $scope.biller_list.push(biller.biller_name);
					// 		//$scope.biller_list.push(biller.biller_name);	
					// 	}												
					// })	

					// }

					$scope.selectedBiller = 'None';
					$scope.find_auth = function (selectedBiller) {

						$scope.selectedBiller = selectedBiller;
						$scope.auth_list = [];
						$scope.regex_list = [];
						$scope.logo = 'None';
						$scope.bill_copy ='None';

						$scope.billers.forEach(function(biller){
							if(biller.biller_name == selectedBiller)	{
								//console.log(biller.authenticators[0].regex);
								for(var i=0;i<biller.authenticators.length;i++){
								
									// if(!($scope.auth_list.includes(biller.authenticators[i].parameter_name)) ){
									
									// $scope.auth_list.push(biller.authenticators[i].parameter_name);
									// }
									if(!($scope.auth_list.includes(biller.authenticators[i])) ){
									
										$scope.auth_list.push(biller.authenticators[i]);
									}
									if(!($scope.regex_list.includes(biller.authenticators[i].regex)) ){
									
										$scope.regex_list.push(biller.authenticators[i].regex);
									}	
								}
																								
								$scope.logo = biller.biller_logo;
								$scope.bill_copy = biller.biller_bill_copy;
																
							console.log($scope.auth_list);
							}												
						})
					//console.log($scope.regex_list);	

					}

					
					
		})

		
		</script>	
	</head>

	<body>
			<div ng-app="mainApp"  ng-controller="controller_biller" ng-show="flag">
			
					<button ng-click="test1('Electricity')">Electric</button>
					<button ng-click="test1('Gas')">Gas</button>
					<button ng-click="test1('Mobile Postpaid')">Mobile</button>
					
					<!-- <div  ng-repeat = "bill in biller_list ">
			
							{{bill}}
								
					</div> -->

					<!-- FILTER BY COUNTRY -->
					<select ng-model="selectedCountry">
							<option ng-repeat="location in country_list" value="{{location}}" ng-click="find_loc_biller(selectedCountry)"> {{location}} </option>
						</select>
					
					<!-- DISPLAY BILLER NAMES -->
					<select ng-model="selectedBiller">
						<option ng-repeat="billername in final_biller_list" value="{{billername}}" ng-click="find_auth(selectedBiller)"> {{billername}} </option>
					</select>

					<!-- <select ng-model="selectedBiller">
							<option ng-repeat="billername in biller_list" value="{{billername}}" ng-click="find_auth(selectedBiller)"> {{billername}} </option>
						</select> -->

				
			
					<h1>{{selectedBiller}}</h1>

					<div  ng-repeat = "auth in auth_list ">
			
							{{auth.regex}}
								
					</div>

					<div>
						<form name="SaveForm" ng-submit="funcSave()">  
							<table  >
							
								<tr ng-repeat = "auth in auth_list">
							   		<td colspan = "2">Enter {{auth.parameter_name}} </td>
							   		<td>:</td>
									   <td colspan = "3">
										   <input type="text" ng-pattern="{{auth.regex}}" required="required" name="name{{auth.seq}}"  ng-model="name">
										   <!-- <span style="color:Red" ng-show="SaveForm.name.$error.required"> Required! </span>  -->
										   <span style="color:red" ng-show="SaveForm.name{{auth.seq}}.$dirty && SaveForm.name{{auth.seq}}.$invalid" class="ng-hide">{{auth.error_message}}</span> 
										   
											
											
										</td>  
								</tr>
								<tr>
									<td colspan = "2"></td>
									<td></td>
									<td colspan = "3"><button type="submit" form="form1" value="Submit">Submit</button></td>  
								</tr>

							 </table>
						</form>
					</div>

					

					<img src="{{logo}}">
					<img src="{{bill_copy}}">
				</div>
		
		

		<!-- <div ng-app="mainApp" ng-controller="controller">
			<div class="container" style="margin-top:400px">
				<div  ng-repeat = "category in category_list ">	
			
					{{category}}
						
				</div>
			</div>	
		</div> -->

		
		<!-- <span class="glyphicon glyphicon-menu-up"></span> -->
		
		
			
	
	</body>
</html>